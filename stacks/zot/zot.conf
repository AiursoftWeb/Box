registry.aiursoft.cn {
    log
    import hsts
    encode br gzip
    # 仅匹配 Docker 进行写操作且尚未认证的请求
    @dockerWriteNoAuth {
        header_regexp User-Agent ^docker/.*
        method     POST PATCH PUT
        path       /v2/*
        not header Authorization
    }

    # 针对上述请求，返回 Basic 认证 Challenge
    handle @dockerWriteNoAuth {
        header WWW-Authenticate 'Basic realm="zot"'
        respond 401
    }

    reverse_proxy http://zot_server:5000 {
    }
}

