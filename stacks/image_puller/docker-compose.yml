version: '3.9'

services:
  downloader:
    image: hub.aiursoft.cn/aiursoft/internalimages/imagepuller
    environment:
      - MIRROR_TARGET=registry.aiursoft.cn
      - DOCKER_USERNAME=anduin2019
      - LOCAL_DOCKER_USERNAME=anduin@aiursoft.com
    secrets:
      - source: docker-key
        target: DOCKER_PASSWORD
      - source: local-docker-key
        target: LOCAL_DOCKER_PASSWORD
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    stop_grace_period: 20s
    deploy:
      replicas: 1
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
      update_config:
        order: start-first
        delay: 5s

secrets:
  docker-key:
    external: true
  local-docker-key:
    external: true
