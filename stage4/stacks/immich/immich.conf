# Untrusted.
immich.aiursoft.com {
    log
    import hsts
    import limit_to_cloudflare
    encode br gzip
    @head_root {
        method HEAD
        path /
    }

    handle @head_root {
        respond "" 200
    }
    reverse_proxy http://immich_immich-server:2283 {
    }
}

ranking.aiursoft.com {
    log
    import hsts
    import limit_to_cloudflare
    encode br gzip

    route {
        reverse_proxy /outpost.goauthentik.io/* http://immich_authentik_proxy:9000 {
            header_up Host {http.reverse_proxy.upstream.host}
        }

        forward_auth http://immich_authentik_proxy:9000 {
            uri     /outpost.goauthentik.io/auth/caddy
            copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
        }

        reverse_proxy http://immich_ranking:5000 {
        }
    }
}

# Untrusted.
immich.aiursoft.cn {
    log
    import hsts
    import limit_to_cloudflare
    encode br gzip
    redir https://immich.aiursoft.com{uri} permanent
}

